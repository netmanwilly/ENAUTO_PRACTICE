import requests
import json
requests.packages.urllib3.disable_warnings()

#SEND GET REQUEST AND GET RESPONSE WITH ALL ORGANIZATIONS IN MERAKI SANDBOX
#LIST OF ORGANIZATIONS RESPONSE ARE LOOPED THROUGH TO SEARCH FOR ANY NETWORKS THAT EXIST
#TRY TO PRINT LIST OF NETWORKS IN A HUMAN READABLE FASHION

user = "devnetmeraki@cisco.com"
password = "Adm!n123!"
BASE_URI = "https://api.meraki.com/api/v1"
API_KEY = "6bec40cf957de430a6f1f2baa056b99a4fac9ea0"
headers = {
    "Authorization": f"Bearer {API_KEY}",
    'Content-Type': 'application/yang-data+json',
   'Accept': 'application/yang-data+json'
    }

def main():

    response = requests.get(BASE_URI + "/organizations", headers=headers, verify=False )
    response.raise_for_status
    if response != 204:
        print(response.status_code)
        data = response.json()
#        print(type(data))

    #LOOP THROUGH LIST    
    for x in data:
        organization_id = x["id"]
        print(f"Checking for Networks in Organization {organization_id}")
        network_list = check_for_networks(organization_id)
        if network_list == None:
            continue
        if len(network_list) >= 1:
            print("FOUND NETWORKS")
            text = f'{organization_id} has the following networks:'
            print(text)
            print("-" * len(text))
            for x in network_list:
                network_id = x['name']
                print(f'        {network_id}')
            print("-" * len(text))
            print('\n\n')
        

def check_for_networks(org_id:str):
    response = requests.get(BASE_URI + f"/organizations/{org_id}/networks", headers=headers, verify=False)
    response.raise_for_status
    if response != 204:
#        print(response.status_code)
        data = response.json()
        if len(data) < 1:
            print(f"No networks found for {org_id}")
            return None
        else:
#            print(type(data))
            return data






if __name__ == "__main__":
    main()